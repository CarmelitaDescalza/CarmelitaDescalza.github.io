tribe.events=tribe.events||{},tribe.events.views=tribe.events.views||{},tribe.events.views.manager={},function(b,c,a){'use strict';var d=b(document),e=b(window);a.selectors={container:'[data-js="tribe-events-view"]',form:'[data-js="tribe-events-view-form"]',link:'[data-js="tribe-events-view-link"]',dataScript:'[data-js="tribe-events-view-data"]',loader:'.tribe-events-view-loader',loaderText:'.tribe-events-view-loader__text',hiddenElement:'.tribe-common-a11y-hidden'},a.doingPopstate=!1,a.currentAjaxRequest=null,a.$lastContainer=b(),a.$containers=b(),a.cleanup=function(g){var c=b(g),e=c.find(a.selectors.form),f=c.find(a.selectors.dataScript),d={};f.length&&(d=JSON.parse(b.trim(f.text()))),c.trigger('beforeCleanup.tribeEvents',[c,d]),c.find(a.selectors.link).off('click.tribeEvents',a.onLinkClick),e.length&&e.off('submit.tribeEvents',a.onSubmit),c.trigger('afterCleanup.tribeEvents',[c,d])},a.setup=function(e,h){var c=b(h),f=c.find(a.selectors.form),g=c.find(a.selectors.dataScript),d={};g.length&&(d=JSON.parse(b.trim(g.text()))),c.trigger('beforeSetup.tribeEvents',[e,c,d]),c.find(a.selectors.link).on('click.tribeEvents',a.onLinkClick),f.length&&f.on('submit.tribeEvents',a.onSubmit),c.trigger('afterSetup.tribeEvents',[e,c,d])},a.getContainer=function(d){var c=b(d);return c.is(a.selectors.container)?c:c.parents(a.selectors.container).eq(0)},a.getContainerData=function(d){var c=d.find(a.selectors.dataScript),e;if(!c.length)return;return e=JSON.parse(b.trim(c.text())),e},a.shouldManageUrl=function(b){var a=b.data('view-manage-url'),c=/^(true|1|on|yes)$/;return typeof a===typeof void 0?a=!0:a=c.test(String(a)),a},a.updateUrl=function(f){var e,d;if(a.doingPopstate)return;if(!a.shouldManageUrl(f))return;if(e=f.find(a.selectors.dataScript),!e.length)return;if(d=JSON.parse(b.trim(e.text())),!c.isObject(d))return;if(c.isUndefined(d.url))return;if(c.isUndefined(d.title))return;document.title=d.title,window.history.pushState(null,d.title,d.url)},a.onLinkClick=function(d){var c=a.getContainer(this),f,i,j,e,k,g,h;return c.trigger('beforeOnLinkClick.tribeEvents',d),d.preventDefault(),f=b(this),i=f.attr('href'),j=window.location.href,e=f.data('view-rest-nonce'),k=a.shouldManageUrl(c),g=c.data('view-shortcode'),e||(e=c.data('view-rest-nonce')),h={prev_url:encodeURI(decodeURI(j)),url:encodeURI(decodeURI(i)),should_manage_url:k,_wpnonce:e},g&&(h.shortcode=g),a.request(h,c),c.trigger('afterOnLinkClick.tribeEvents',d),!1},a.onSubmit=function(d){var c=a.getContainer(this),e,f,g,h;return c.trigger('beforeOnSubmit.tribeEvents',d),d.preventDefault(),e=b(this),f=c.data('view-rest-nonce'),g=Qs.parse(e.serialize()),h={view_data:g['tribe-events-views'],_wpnonce:f},a.request(h,c),c.trigger('afterOnSubmit.tribeEvents',d),!1},a.onPopState=function(c){var d=c.originalEvent.target,e=d.location.href,b=a.getLastContainer(),f,g;return!!b&&(a.currentAjaxRequest&&a.currentAjaxRequest.abort(),a.doingPopstate=!0,b.trigger('beforePopState.tribeEvents',c),f=b.data('view-rest-nonce'),g={url:e,_wpnonce:f},a.request(g,b),!1)},a.setupRequestData=function(c,d){var g=a.shouldManageUrl(d),e=a.getContainerData(d),f;return c.url||(c.url=e.url),c.prev_url||(c.prev_url=e.prev_url),c.should_manage_url=g,f=d.data('tribeRequestData'),!b.isPlainObject(f)?c:b.extend(f,c)},a.request=function(d,c){c.trigger('beforeRequest.tribeEvents',[d,c]);var e=a.getAjaxSettings(c);e.data=a.setupRequestData(d,c),a.currentAjaxRequest=b.ajax(e),c.trigger('afterRequest.tribeEvents',[d,c])},a.getAjaxSettings=function(b){var c={url:b.data('view-rest-url'),accepts:'html',dataType:'html',method:b.data('view-rest-method')||'POST',async:!0,beforeSend:a.ajaxBeforeSend,complete:a.ajaxComplete,success:a.ajaxSuccess,error:a.ajaxError,context:b};return c},a.ajaxBeforeSend=function(d,e){var b=this,c=b.find(a.selectors.loader),f;b.trigger('beforeAjaxBeforeSend.tribeEvents',[d,e]),c.length&&(c.removeClass(a.selectors.hiddenElement.className()),f=c.find(a.selectors.loaderText),f.text(f.text())),b.attr('aria-busy','true'),b.trigger('afterAjaxBeforeSend.tribeEvents',[d,e])},a.ajaxComplete=function(c,d){var b=this,e=b.find(a.selectors.loader);b.trigger('beforeAjaxComplete.tribeEvents',[c,d]),e.length&&e.addClass(a.selectors.hiddenElement.className()),b.trigger('afterAjaxComplete.tribeEvents',[c,d]),a.doingPopstate&&(a.doingPopstate=!1),a.currentAjaxRequest=null},a.ajaxSuccess=function(d,e,f){var c=this,g;c.trigger('beforeAjaxSuccess.tribeEvents',[d,e,f]),g=b(d),a.cleanup(c),c.replaceWith(g),c=g,a.setup(0,c),a.selectContainers(),a.updateUrl(c),c.trigger('afterAjaxSuccess.tribeEvents',[d,e,f]),a.shouldManageUrl(c)&&(a.$lastContainer=c)},a.ajaxError=function(a,b){var c=this;c.trigger('beforeAjaxError.tribeEvents',[a,b]),c.trigger('afterAjaxError.tribeEvents',[a,b])},a.selectContainers=function(){a.$containers=b(a.selectors.container)},a.getLastContainer=function(){return a.$lastContainer.length||(a.$lastContainer=a.$containers.filter('[data-view-manage-url="1"]').eq(0)),a.$lastContainer},a.ready=function(){a.selectContainers(),a.$containers.each(a.setup)},d.ready(a.ready),e.on('popstate',a.onPopState)}(jQuery,window.underscore||window._,tribe.events.views.manager)